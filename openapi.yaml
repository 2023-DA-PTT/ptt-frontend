---
openapi: 3.0.3
info:
  title: ptt-backend API
  version: 1.0.0-SNAPSHOT
paths:
  /api/datapoint:
    get:
      tags:
      - Data Point Resource
      operationId: getAllDataPoints
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DataPointDto'
  /api/datapoint/planrun/{planRunId}:
    get:
      tags:
      - Data Point Resource
      operationId: getDataPointsForPlanRun
      parameters:
      - name: planRunId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DataPointDto'
  /api/datapoint/planrun/{planRunId}/step/{stepId}:
    get:
      tags:
      - Data Point Resource
      operationId: getDataPointsForStep
      parameters:
      - name: planRunId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: aggr
        in: query
        schema:
          type: string
      - name: from
        in: query
        schema:
          format: int64
          type: integer
      - name: interval
        in: query
        schema:
          format: int64
          type: integer
      - name: to
        in: query
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
  /api/node/locations:
    get:
      tags:
      - Node Resource
      operationId: getAllNodeLocations
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                uniqueItems: true
                type: array
                items:
                  type: string
  /api/plan:
    get:
      tags:
      - Plan Resource
      operationId: getAllPlans
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlanDto'
  /api/plan/export/{id}:
    get:
      tags:
      - Plan Resource
      operationId: export
      parameters:
      - name: id
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
  /api/plan/import:
    post:
      tags:
      - Plan Resource
      operationId: importPlan
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanExportDto'
      responses:
        "200":
          description: OK
  /api/plan/user/{userId}:
    get:
      tags:
      - Plan Resource
      operationId: getAllPlansForUser
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlanDto'
  /api/plan/{id}:
    get:
      tags:
      - Plan Resource
      operationId: getPlanById
      parameters:
      - name: id
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlanDto'
  /api/plan/{planId}/step:
    get:
      tags:
      - Step Resource
      operationId: getAllStepsForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StepWithNextsDto'
  /api/plan/{planId}/step/http:
    get:
      tags:
      - Http Step Resource
      operationId: getAllHttpStepsForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HttpStepDto'
    post:
      tags:
      - Http Step Resource
      operationId: createHttpStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HttpStepDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/script:
    get:
      tags:
      - Script Step Resource
      operationId: getAllScriptStepsForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ScriptStepDto'
    post:
      tags:
      - Script Step Resource
      operationId: createScriptStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScriptStepDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}:
    get:
      tags:
      - Step Resource
      operationId: getAllStepByIdForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StepDto'
    delete:
      tags:
      - Step Resource
      operationId: deleteStepById
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/http:
    get:
      tags:
      - Http Step Resource
      operationId: getHttpStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
    put:
      tags:
      - Http Step Resource
      operationId: updateHttpStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HttpStepDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/inputArgument:
    get:
      tags:
      - Input Argument Resource
      operationId: getAllInputArgumentForStep
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InputArgumentDto'
    post:
      tags:
      - Input Argument Resource
      operationId: createInputArgumentForStep
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InputArgumentDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/inputArgument/{inArgId}:
    get:
      tags:
      - Input Argument Resource
      operationId: getInputArgumentByIdForStep
      parameters:
      - name: inArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InputArgumentDto'
    put:
      tags:
      - Input Argument Resource
      operationId: putInputArgumentForStep
      parameters:
      - name: inArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InputArgumentDto'
      responses:
        "200":
          description: OK
    delete:
      tags:
      - Input Argument Resource
      operationId: deleteInputArgumentById
      parameters:
      - name: inArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/nexts:
    get:
      tags:
      - Step Resource
      operationId: getAllNextsByIdForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/NextStepWithParameterRelationDto'
    post:
      tags:
      - Step Resource
      operationId: updateAllNextsByIdForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/NextStepWithParameterRelationDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/outputArgument:
    get:
      tags:
      - Output Argument Resource
      operationId: getAllOutputArgumentForStep
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OutputArgumentDto'
    post:
      tags:
      - Output Argument Resource
      operationId: createOutputArgumentForStep
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OutputArgumentDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/outputArgument/{outArgId}:
    get:
      tags:
      - Output Argument Resource
      operationId: getOutputArgumentByIdForStep
      parameters:
      - name: outArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutputArgumentDto'
    put:
      tags:
      - Output Argument Resource
      operationId: putOutputArgumentForStep
      parameters:
      - name: outArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OutputArgumentDto'
      responses:
        "200":
          description: OK
    delete:
      tags:
      - Output Argument Resource
      operationId: deleteOutputArgumentById
      parameters:
      - name: outArgId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/parameterRelation:
    post:
      tags:
      - Step Parameter Relation Resource
      operationId: createParameterRelation
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StepParameterRelationDto'
      responses:
        "200":
          description: OK
  /api/plan/{planId}/step/{stepId}/parameterRelation/from:
    get:
      tags:
      - Step Parameter Relation Resource
      operationId: getAllParameterRelationForStepFrom
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StepParameterRelationDto'
  /api/plan/{planId}/step/{stepId}/parameterRelation/to:
    get:
      tags:
      - Step Parameter Relation Resource
      operationId: getAllParameterRelationForStepTo
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StepParameterRelationDto'
  /api/plan/{planId}/step/{stepId}/script:
    get:
      tags:
      - Script Step Resource
      operationId: getScriptStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
    put:
      tags:
      - Script Step Resource
      operationId: updateScriptStepForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      - name: stepId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScriptStepDto'
      responses:
        "200":
          description: OK
  /api/plan/{userId}:
    post:
      tags:
      - Plan Resource
      operationId: createPlanForUser
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanDto'
      responses:
        "200":
          description: OK
  /api/planrun:
    get:
      tags:
      - Plan Run Resource
      operationId: getAllPlanRuns
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlanRunDto'
    post:
      tags:
      - Plan Run Resource
      operationId: createPlanRun
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanRunDto'
      responses:
        "200":
          description: OK
  /api/planrun/plan/{planId}:
    get:
      tags:
      - Plan Run Resource
      operationId: getPlanRunsForPlan
      parameters:
      - name: planId
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PlanRunDto'
  /api/planrun/{planrunid}:
    get:
      tags:
      - Plan Run Resource
      operationId: getPlanRunById
      parameters:
      - name: planrunid
        in: path
        required: true
        schema:
          format: int64
          type: integer
      responses:
        "200":
          description: OK
components:
  schemas:
    AdvancedStepParameterRelationDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        inputArg:
          $ref: '#/components/schemas/InputArgumentDto'
        outputArgId:
          format: int64
          type: integer
    DataPointDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        planRunId:
          format: int64
          type: integer
        stepId:
          format: int64
          type: integer
        startTime:
          format: int64
          type: integer
        duration:
          format: int64
          type: integer
    HttpStepDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        description:
          type: string
        method:
          type: string
        url:
          type: string
        body:
          type: string
        responseContentType:
          $ref: '#/components/schemas/RequestContentType'
        contentType:
          $ref: '#/components/schemas/RequestContentType'
        headers:
          type: array
          items:
            $ref: '#/components/schemas/HttpStepHeaderDto'
    HttpStepHeaderDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        value:
          type: string
        stepId:
          format: int64
          type: integer
    InputArgumentDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        stepId:
          format: int64
          type: integer
    NextStepWithParameterRelationDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        toStep:
          $ref: '#/components/schemas/StepDto'
        repeatAmount:
          format: int32
          type: integer
        stepParameterRelations:
          type: array
          items:
            $ref: '#/components/schemas/AdvancedStepParameterRelationDto'
    OutputArgumentDto:
      type: object
      properties:
        stepId:
          format: int64
          type: integer
        id:
          format: int64
          type: integer
        name:
          type: string
        parameterLocation:
          type: string
        outputType:
          $ref: '#/components/schemas/OutputType'
    OutputType:
      enum:
      - PLAIN_TEXT
      - OCTET_STREAM
      - FROM_INPUT_PARAMETER
      type: string
    PlanDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        startId:
          format: int64
          type: integer
        name:
          type: string
        description:
          type: string
    PlanExportDto:
      type: object
      properties:
        plan:
          $ref: '#/components/schemas/PlanDto'
        httpSteps:
          type: array
          items:
            $ref: '#/components/schemas/HttpStepDto'
        scriptSteps:
          type: array
          items:
            $ref: '#/components/schemas/ScriptStepDto'
        inputs:
          type: array
          items:
            $ref: '#/components/schemas/InputArgumentDto'
        outputs:
          type: array
          items:
            $ref: '#/components/schemas/OutputArgumentDto'
        relations:
          type: array
          items:
            $ref: '#/components/schemas/StepParameterRelationDto'
        nextSteps:
          type: array
          items:
            $ref: '#/components/schemas/SimpleNextStepDto'
    PlanRunDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        planId:
          format: int64
          type: integer
        startTime:
          format: int64
          type: integer
        duration:
          format: int64
          type: integer
        runOnce:
          type: boolean
        name:
          type: string
        planRunInstructions:
          type: array
          items:
            $ref: '#/components/schemas/PlanRunInstructionDto'
    PlanRunInstructionDto:
      type: object
      properties:
        numberOfClients:
          format: int32
          type: integer
        nodeName:
          type: string
    RequestContentType:
      enum:
      - APPLICATION_JSON
      - MULTIPART_FORM_DATA
      type: string
    ScriptStepDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        description:
          type: string
        script:
          type: string
    SimpleNextStepDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        fromStepId:
          format: int64
          type: integer
        toStepId:
          format: int64
          type: integer
        repeatAmount:
          format: int32
          type: integer
    StepDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        description:
          type: string
        type:
          type: string
    StepParameterRelationDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        fromId:
          format: int64
          type: integer
        toId:
          format: int64
          type: integer
    StepWithNextsDto:
      type: object
      properties:
        id:
          format: int64
          type: integer
        name:
          type: string
        description:
          type: string
        type:
          type: string
        nexts:
          type: array
          items:
            $ref: '#/components/schemas/SimpleNextStepDto'
